<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">
  <title>Info 3300 Project</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    
    .gridlines line {
      stroke: #bbb;
    }
    
    .gridlines .domain {
      stroke: none;
    }
  
  </style>
  </head>

  <body>
   <svg id="bargraph" height="600" width="600"></svg>
    <div id="gender-button"></div>


   <script>
     
    const svg = d3.select("svg#bargraph");
    const width = svg.attr("width");
    const height = svg.attr("height");
    const margins = {top: 10, right: 10, bottom: 50, left: 50};
    const chartWidth = width - margins.left - margins.right;
    const chartHeight = height - margins.top - margins.bottom;
    let graph = svg.append('g');
    let chartArea = svg.append("g").attr("transform",`translate(${margin.left},${margin.top})`);

    d3.csv("Licensed_Drivers.csv", d3.autoType).then(function(data){
  
      data = data.filter((d)=> {return d['State'] == ‘New York’;}  );

      data.forEach(d) => {
          d['female'] = d['Gender'] == 'Female';
          d['male'] = d['Gender'] == 'Male';
  
      });


        const ageExtent = d3.extent(data, d => d['Cohort']);
        const driversExtent = d3.extent(data, d => d['Drivers']);


        const xScale = d3.scaleLinear()
            .domain(ageExtent)
            .range([0, chartWidth]); 

        const yScale = d3.scaleLog()
            .domain(driversExtent)
            .range([chartHeight, 0]); 

        let leftAxis = d3.axisLeft(yScale);
        graph.append('g')
            .attr('class', 'y axis')
            .attr('transform',`translate(${margins.left-10},${margins.top})`) 
            .call(leftAxis);
        let leftGridlines = d3.axisLeft(yScale)
            .tickSize(-chartWidth-10)
            .tickFormat('');
        graph.append('g')
            .attr('class', 'y gridlines')
            .attr('transform',`translate(${margins.left-10},${margins.top})`)
            .call(leftGridlines);    



        let bottomAxis = d3.axisBottom(xScale);
        graph.append('g')
            .attr('class', 'x axis')
            .attr('transform',`translate(${margins.left},${chartHeight+margins.top+10})`)
            .call(bottomAxis);    
        let bottomGridlines = d3.axisBottom(xScale)
            .tickSize(-chartHeight-10)
            .tickFormat('');
        graph.append('g')
            .attr('class', 'x gridlines')
            .attr('transform',`translate(${margins.left},${chartHeight+margins.top+10})`)
            .call(bottomGridlines);  

       chartArea.selectAll('rect.bar').data( data )
            .join('rect').attr('class','bar')
            .attr("fill", "blue")
            .attr("x", d => xScale(d.Cohort))
            .attr("y", d => yScale(d.Drivers))
            .attr("height", d => yScale(0) - yScale(d.Drivers))
            .attr("width", xScale.bandwidth());

       const allKeys = Object.keys(data).sort();
        allKeys.forEach(d => {
          d3.select("div#gender-button")
            .append("button")
            .text(d)
            .on("click", function() {
              updateBarsAnimated(d);
            })
        });
        updateBarsAnimated('Male');
       
    });

   </script>

  </body>

  </html>
